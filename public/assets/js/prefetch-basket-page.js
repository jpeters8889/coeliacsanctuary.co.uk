(self.webpackChunk=self.webpackChunk||[]).push([[844],{1560:(t,e,a)=>{"use strict";a.d(e,{Z:()=>i});const i={methods:{formatPrice:function(t){return t=(t/100).toFixed(2),"&pound;".concat(t)}}}},9081:(t,e,a)=>{"use strict";a.d(e,{Z:()=>i});const i={methods:{googleEvent:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};window.gtag&&window.gtag(t,e,a)}}}},2102:(t,e,a)=>{"use strict";a.d(e,{Z:()=>i});const i={data:function(){return{hasError:!1,showError:!1,errorText:"",currentValue:""}},props:{type:{type:String,default:"text"},name:{type:String,required:!0},value:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},min:{type:Number,default:null},max:{type:Number,default:null},pattern:{type:RegExp,default:null},patternError:{type:String,default:"Field is Invalid"},match:{type:String,default:null}},mounted:function(){var t=this;this.currentValue=this.value,this.required&&""===this.currentValue&&(this.hasError=!0),this.$root.$on(this.name+"-get-value",(function(){t.validate(),t.$root.$emit(t.name+"-value",t.currentValue)})),this.$root.$on(this.name+"-set-value",(function(e){t.currentValue=e,t.hasError=!0,t.validate()})),this.$root.$on(this.name+"-reset",(function(){t.currentValue="",t.showError=!1})),this.$root.$on(this.name+"-validate",(function(){t.hasError=!0,t.validate()}))},methods:{validate:function(){if(this.showError=!0,this.required&&""===this.currentValue)return this.errorText="Field is required",void this.pushError();if(this.pattern&&(this.required||""!==this.currentValue)&&!this.currentValue.match(this.pattern))return this.errorText=this.patternError,void this.pushError();if(this.match&&this.currentValue!==this.match)return this.errorText="Field does not match",void this.pushError();switch(this.type){case"email":if(!this.checkEmail())return this.errorText="Must be a valid email address",void this.pushError()}this.hasError=!1,this.errorText="",this.$root.$emit(this.name+"-valid")},checkEmail:function(){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.currentValue)},pushError:function(){this.hasError=!0,this.$root.$emit(this.name+"-error",this.errorText)}},watch:{hasError:function(){this.hasError?this.$root.$emit(this.name+"-error",this.errorText):this.$root.$emit(this.name+"-valid")},currentValue:function(t){this.$root.$emit(this.name+"-change",t)}}}},2394:(t,e,a)=>{"use strict";a.d(e,{Z:()=>i});a(2732);const i={methods:{loadLazyImages:function(){coeliac().updateLazyloader()}},computed:{lazyLoadSrc:function(){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 2'%3E%3C/svg%3E"}}}},2840:(t,e,a)=>{"use strict";function i(t){return new Promise((function(e){if(document.querySelector('script[src="'+t+'"]'))e();else{var a=document.createElement("script");a.setAttribute("src",t),document.body.appendChild(a),a.addEventListener("load",e)}}))}a.d(e,{v:()=>i})},7289:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var i=a(3645),o=a.n(i)()((function(t){return t[1]}));o.push([t.id,"input:focus{outline:none}input:-webkit-autofill{background:none}",""]);const s=o},4055:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var i=a(3645),o=a.n(i)()((function(t){return t[1]}));o.push([t.id,"input:focus{outline:none}input:-webkit-autofill{background:none}",""]);const s=o},5117:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var i=a(3645),o=a.n(i)()((function(t){return t[1]}));o.push([t.id,"input:focus{outline:none}input:-webkit-autofill{background:none}",""]);const s=o},2499:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>N});var i=a(1560),o=a(2394),s=a(9081),r=a(511);const n={mixins:[a(2102).Z],props:{options:{required:!0,type:Array},label:{required:!0,type:String}},methods:{changeOption:function(t){this.currentValue=t,this.validate()}}};var l=a(3379),c=a.n(l),d=a(4055),u={insert:"head",singleton:!1};c()(d.Z,u);d.Z.locals;var p=a(1900);const m=(0,p.Z)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex flex-col"},[a("span",{staticClass:"font-semibold text-lg mb-2"},[t._v(t._s(t.label))]),t._v(" "),t._l(t.options,(function(e){return a("div",{staticClass:"flex items-center cursor-pointer",on:{click:function(a){return t.changeOption(e.value)}}},[a("div",{staticClass:"p-2 pl-0"},[a("div",{staticClass:"border border-grey-off bg-grey-lightest p-1 text-xl",class:e.value===t.currentValue?"text-green":"text-grey-off-light"},[a("font-awesome-icon",{attrs:{icon:["fas","check"]}})],1)]),t._v(" "),a("div",{staticClass:"flex-1"},[t._v("\n            "+t._s(e.label)+"\n        ")])])}))],2)}),[],!1,null,null,null).exports;var h=a(2460);const f={components:{"form-input":r.Z,"form-option":m,"form-select":h.Z},props:{defaultData:{type:Object,required:!0},countryId:{type:Number,required:!0}},mounted:function(){var t=this;Object.keys(this.validity).forEach((function(e){t.$root.$on("".concat(e,"-error"),(function(){t.validity[e]=!1})),t.$root.$on("".concat(e,"-valid"),(function(){t.validity[e]=!0})),t.$root.$on("".concat(e,"-value"),(function(a){t.formData[e]=a})),t.$root.$on("".concat(e,"-change"),(function(a){t.formData[e]=a})),""!==t.defaultData[e]&&t.$root.$emit("".concat(e,"-set-value"),t.defaultData[e])})),Object.values(this.defaultData).includes("")||Object.values(this.defaultData).filter((function(t){return""===t})).length===Object.values(this.defaultData).length||this.validateForm()},methods:{submitForm:function(t){this.validateForm()&&this.$root.$emit("checkout-continue",{id:t,data:this.formData})},goBack:function(){this.$root.$emit("checkout-back")},validateForm:function(){var t=this;Object.keys(this.validity).forEach((function(e){t.validity[e]=!0,t.$root.$emit("".concat(e,"-validate"))}));var e=!0;return Object.keys(this.validity).forEach((function(a){!1===t.validity[a]&&(e=!1)})),e}},computed:{isDisabled:function(){return Object.values(this.validity).includes(!1)}},watch:{validity:{deep:!0,handler:function(){this.$root.$emit("payment-button-disabled",Object.values(this.validity).includes(!1))}}}},v={mixins:[f],data:function(){return{formData:{name:"",email:"",emailConfirmation:"",phone:""},validity:{name:!1,email:!1,emailConfirmation:!1,phone:!0}}}};const g=(0,p.Z)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex flex-col leading-none"},[a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Your Name",name:"name",value:t.formData.name}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",type:"email",placeholder:"Your Email",name:"email",value:t.formData.email}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",type:"email",placeholder:"Confirm your Email",name:"emailConfirmation",value:t.formData.emailConfirmation,match:t.formData.email}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{type:"tel",placeholder:"Your Phone Number (Optional)",name:"phone",value:t.formData.phone,pattern:/[0-9\-+ ]+/}})],1),t._v(" "),a("div",{staticClass:"py-1 text-right"},[a("button",{staticClass:"py-3 px-6 rounded-lg font-semibold",class:t.isDisabled?"bg-yellow-50 cursor-not-allowed":"bg-yellow",attrs:{disabled:t.isDisabled},on:{click:function(e){return t.submitForm("user-details")}}},[t._v("\n            Next...\n        ")])])])}),[],!1,null,null,null).exports;const y={mixins:[f],data:function(){return{displayLookup:!1,lookupResults:[],formData:{postcode:"",address1:"",address2:"",address3:"",town:""},validity:{postcode:!1,address1:!1,address2:!0,address3:!0,town:!1}}},methods:{lookupPostcode:function(){var t=this;this.validity.postcode?coeliac().request().post("/api/shop/lookup",{postcode:this.formData.postcode}).then((function(e){if(200===e.status)return t.lookupResults=e.data.data,void(t.displayLookup=!0);coeliac().error("There was an error looking up this postcode")})).catch((function(){coeliac().error("There was an error looking up this postcode")})):coeliac().error("Please enter a valid UK Postcode or change the delivery country above!")},selectLookupResult:function(t){var e=this;this.formData.address1=t.address_1,this.formData.address2=t.address_2||"",this.formData.address3=t.address_3||"",this.formData.town=t.town,this.formData.postcode=t.postcode,this.displayLookup=!1,this.lookupResults=[],Object.keys(this.validity).forEach((function(t){e.$root.$emit("".concat(t,"-set-value"),e.formData[t])}))},canLookupPostcode:function(){return 1===this.countryId}},computed:{postcodePattern:function(){return this.canLookupPostcode()?/^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$/i:/.*/}},watch:{displayLookup:function(t){t?document.querySelector("body").classList.add("overflow-hidden"):document.querySelector("body").classList.remove("overflow-hidden")}}};const b=(0,p.Z)(y,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex flex-col leading-none"},[a("div",{staticClass:"py-1 flex relative"},[a("form-input",{staticClass:"flex-1",attrs:{required:"",placeholder:"Postcode",name:"postcode",pattern:t.postcodePattern,"pattern-error":"Please enter a valid UK Postcode",value:t.formData.postcode}}),t._v(" "),t.canLookupPostcode()?a("button",{staticClass:"py-2 px-4 text-sm rounded-lg font-semibold bg-yellow ml-2",on:{click:function(e){return t.lookupPostcode()}}},[t._v("\n            Search\n        ")]):t._e(),t._v(" "),t.canLookupPostcode()&&t.displayLookup?a("div",{staticClass:"absolute w-full bg-grey-lightest border border-grey shadow max-h-map scrollable",staticStyle:{top:"100%"}},t._l(t.lookupResults,(function(e){return a("ul",[a("li",{staticClass:"p-2 border-b border-grey cursor-pointer hover:bg-grey-off-light transition-bg",on:{click:function(a){return t.selectLookupResult(e)}}},[t._v("\n                    "+t._s(e.friendly)+"\n                ")])])})),0):t._e()],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Address Line 1",name:"address1",value:t.formData.address1}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{placeholder:"Address Line 2 (Optional)",name:"address2",value:t.formData.address2}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{placeholder:"Address Line 3 (Optional)",name:"address3",value:t.formData.address3}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Town/City",name:"town",value:t.formData.town}})],1),t._v(" "),a("div",{staticClass:"py-1 flex justify-between"},[a("button",{staticClass:"py-3 px-6 rounded-lg font-semibold bg-yellow",on:{click:function(e){return t.goBack()}}},[t._v("\n            Back...\n        ")]),t._v(" "),a("button",{staticClass:"py-3 px-6 rounded-lg font-semibold",class:t.isDisabled?"bg-yellow-50 cursor-not-allowed":"bg-yellow",attrs:{disabled:t.isDisabled},on:{click:function(e){return t.submitForm("shipping-address")}}},[t._v("\n            Next...\n        ")])])])}),[],!1,null,null,null).exports;var x=a(2840),_=a(8975);const w={mixins:[s.Z],data:function(){return{stripe:null,stripeElements:null,cardElement:null,checkoutData:null,isDisabled:!0,hasStartedPayment:!1}},mounted:function(){var t=this;this.$root.$on("payment-button-disabled",(function(e){t.isDisabled=e})),(0,x.v)("https://js.stripe.com/v3/").then((function(){t.stripe=new Stripe(window.config.shop.stripe),t.stripeElements=t.stripe.elements(),t.cardElement=t.stripeElements.create("card",{classes:{base:"text-base border border-blue rounded bg-grey-lightest w-full p-3 m-0 text-grey-darkest text-grey-light"},hidePostalCode:!0}),t.cardElement.mount("#stripe"),t.cardElement.on("change",(function(e){t.$root.$emit(e.complete?"card-valid":"card-error")}))})),this.$root.$on("initiate-payment",(function(e){t.checkoutData=e,t.executePayment()}))},methods:{initiatePayment:function(){this.$root.$emit("prepare-payment")},executePayment:function(){var t=this;this.hasStartedPayment?this.stripeError():(this.hasStartedPayment=!0,this.isDisabled=!0,this.googleEvent("event","set-checkout-option",{event_label:"stripe"}),this.stripe.createPaymentMethod("card",this.cardElement,{billing_details:{name:this.checkoutData.user.name,address:{line1:this.checkoutData.billing.address1,line2:this.checkoutData.billing.address2,city:this.checkoutData.billing.town,postal_code:this.checkoutData.billing.postcode,country:(0,_.zQ)(sessionStorage.getItem("checkout-country"),"en")}}}).then((function(e){if(e.error)return t.hasStartedPayment=!1,t.stripeError();t.checkoutData.payment={provider:"stripe",token:e.paymentMethod.id},coeliac().request().post("/api/shop/order",t.checkoutData).then((function(e){if(200===e.status)return t.confirmResponse(e);t.stripeError(),t.hasStartedPayment=!1})).catch((function(){t.stripeError(),t.hasStartedPayment=!1}))})))},confirmResponse:function(t){t.data.success?this.$root.$emit("complete-order"):t.data.requires_action&&this.validatePayment(t.data.client_secret,t.data.payment_id)},stripeError:function(){this.isDisabled=!1,this.$root.$emit("hide-page-load"),coeliac().error("There was an completing your order, you have not been charged, please check all fields and try again...")},validatePayment:function(t,e){var a=this;this.stripe.handleCardAction(t).then((function(t){if(t.error)return a.stripeError();coeliac().request().patch("/api/shop/order",{payment:{provider:"stripe",token:e}}).then((function(t){if(200===t.status)return a.confirmResponse(t);a.stripeError(),a.hasStartedPayment=!1})).catch((function(){a.stripeError(),a.hasStartedPayment=!1}))}))}}};const k=(0,p.Z)(w,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._v(" "),a("div",{staticClass:"py-1 mt-4"},[a("button",{staticClass:"py-3 px-6 rounded-lg font-semibold w-full",class:t.isDisabled?"bg-yellow-50 cursor-not-allowed":"bg-yellow",attrs:{disabled:t.isDisabled},on:{click:function(e){return t.initiatePayment()}}},[t._v("\n            Pay Now\n        ")])])])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"py-1 mt-4"},[a("span",{staticClass:"block font-semibold text-lg mb-2"},[t._v("\n            Payment Details\n        ")]),t._v(" "),a("div",{attrs:{id:"stripe"}})])}],!1,null,null,null).exports;const C={mixins:[s.Z],data:function(){return{paypalResolver:null}},mounted:function(){var t=this;this.$root.$on("initiate-payment",(function(e){t.checkoutData=e,t.executePayment()})),(0,x.v)("https://www.paypalobjects.com/api/checkout.js").then((function(){paypal.Button.render({env:window.config.shop.paypal,style:{size:"medium"},commit:!0,payment:function(e){t.$root.$emit("prepare-payment"),t.paypalResolver=e},onAuthorize:function(e){t.processPayment(e)},onCancel:function(){t.paypalError()},onError:function(){t.paypalError()}},"#paypal-button")}))},methods:{paypalError:function(){this.$root.$emit("hide-page-load"),coeliac().error("There was an completing your order, you have not been charged, please check all fields and try again...")},executePayment:function(){var t=this;this.checkoutData.payment={provider:"paypal"},this.googleEvent("event","set-checkout-option",{event_label:"paypal"}),coeliac().request().post("/api/shop/order",this.checkoutData).then((function(e){200!==e.status?t.paypalError():t.paypalResolver(e.data.id)})).catch((function(){t.paypalError()}))},processPayment:function(t){var e=this;coeliac().request().patch("/api/shop/order",{payment:{provider:"paypal",id:t.paymentID,payer:t.payerID}}).then((function(t){200!==t.status||"approved"!==t.data.state?e.paypalError():e.$root.$emit("complete-order")})).catch((function(){e.paypalError()}))}}};const $={mixins:[f],components:{"stripe-checkout":k,"paypal-checkout":(0,p.Z)(C,(function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"py-1 mt-4"},[e("div",{attrs:{id:"paypal-button"}})])}],!1,null,null,null).exports},data:function(){return{paymentProviders:[{value:"stripe",label:"by Credit / Debit Card"},{value:"paypal",label:"by PayPal"}],billingOptions:[{value:"1",label:"Same as Shipping Address"},{value:"0",label:"Other"}],formData:{provider:"",shippingAddress:"1",billingName:"",billingAddress1:"",billingAddress2:"",billingAddress3:"",billingTown:"",billingPostcode:"",billingCountry:""},validity:{provider:!1,shippingAddress:!0,billingName:!0,billingAddress1:!0,billingAddress2:!0,billingAddress3:!0,billingTown:!0,billingPostcode:!0,billingCountry:!0,card:!1}}},mounted:function(){var t=this;this.$root.$emit("shippingAddress-set-value","1"),this.$root.$on("prepare-payment",(function(){t.initiatePayment()})),this.$root.$on("complete-order",(function(){t.completeOrder()})),Object.keys(this.validity).forEach((function(e){e.includes("billing")&&(t.formData[e]=t.defaultData[e],t.$root.$emit("".concat(e,"-set-value"),t.defaultData[e]))}))},methods:{initiatePayment:function(){this.$root.$emit("full-page-load"),this.validateForm()&&this.$root.$emit("initiate-payment",this.bundleData())},completeOrder:function(){sessionStorage.removeItem("checkout-data"),sessionStorage.removeItem("checkout-country"),window.location.href="/shop/basket/done"},bundleData:function(){var t=JSON.parse(sessionStorage.getItem("checkout-data"));return{user:{name:t[0].data.name,email:t[0].data.email,emailConfirmation:t[0].data.emailConfirmation,phone:t[0].data.phone},shipping:{address1:t[1].data.address1,address2:t[1].data.address2,address3:t[1].data.address3,town:t[1].data.town,postcode:t[1].data.postcode,country:sessionStorage.getItem("checkout-country")},billing:{name:this.formData.billingName,address1:this.formData.billingAddress1,address2:this.formData.billingAddress2,address3:this.formData.billingAddress3,town:this.formData.billingTown,postcode:this.formData.billingPostcode,country:this.formData.billingCountry}}}},watch:{"formData.shippingAddress":function(t){var e=this;this.$root.$emit("shippingAddress-set-value",t),"1"!==t?Object.keys(this.validity).forEach((function(t){t.includes("billing")&&(e.formData[t]="",e.$root.$emit("".concat(t,"-set-value"),""),"billingAddress2"!==t&&"billingAddress3"!==t&&(e.$root.$emit("".concat(t,"-error")),e.$root.$emit("".concat(t,"-validate"))))})):Object.keys(this.validity).forEach((function(t){t.includes("billing")&&(e.formData[t]=e.defaultData[t],e.$root.$emit("".concat(t,"-set-value"),e.defaultData[t]),e.$root.$emit("".concat(t,"-valid")),e.$root.$emit("".concat(t,"-validate")))}))}}};const D=(0,p.Z)($,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex flex-col leading-none"},[a("div",{staticClass:"py-1"},[a("form-option",{attrs:{required:"",name:"provider",label:"Payment Method",value:t.formData.provider,options:t.paymentProviders}})],1),t._v(" "),"stripe"===t.formData.provider?[a("div",{staticClass:"py-1"},[a("form-select",{attrs:{required:"",label:"Billing Address",name:"shippingAddress",value:t.formData.shippingAddress,options:t.billingOptions}})],1),t._v(" "),"0"===t.formData.shippingAddress?[a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Billing Name",name:"billingName",value:t.formData.billingName}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Billing Address Line 1",name:"billingAddress1",value:t.formData.billingAddress1}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{placeholder:"Billing Address Line 2 (Optional)",name:"billingAddress2",value:t.formData.billingAddress2}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{placeholder:"Billing Address Line 3 (Optional)",name:"billingAddress3",value:t.formData.billingAddress3}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Town/City",name:"billingTown",value:t.formData.billingTown}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Billing Postcode",name:"billingPostcode",value:t.formData.billingPostcode}})],1),t._v(" "),a("div",{staticClass:"py-1"},[a("form-input",{attrs:{required:"",placeholder:"Billing Country",name:"billingCountry",value:t.formData.billingCountry}})],1)]:t._e(),t._v(" "),a("stripe-checkout")]:t._e(),t._v(" "),"paypal"===t.formData.provider?[a("paypal-checkout")]:t._e()],2)}),[],!1,null,null,null).exports,E={mixins:[s.Z],props:{countryId:{type:Number,required:!0}},components:{"basket-checkout-user-details":g,"basket-checkout-shipping-details":b,"basket-checkout-payment-details":D},mounted:function(){var t=this;sessionStorage.getItem("checkout-data")?this.sections=JSON.parse(sessionStorage.getItem("checkout-data")):sessionStorage.setItem("checkout-data",JSON.stringify(this.sections)),this.$root.$on("checkout-continue",(function(e){t.completeSection(e)})),this.$root.$on("checkout-back",(function(){t.goBack()}))},data:function(){return{sections:[{id:"user-details",title:"Your Details",component:"basket-checkout-user-details",completed:!0,active:!0,canVisit:!1,data:{name:"",email:"",emailConfirmation:"",phone:""}},{id:"shipping-address",title:"Shipping Address",component:"basket-checkout-shipping-details",completed:!1,active:!1,canVisit:!1,data:{postcode:"",address1:"",address2:"",address3:"",town:"",billingAddress:!0}},{id:"payment",title:"Payment",component:"basket-checkout-payment-details",completed:!1,active:!1,canVisit:!1,data:{provider:"",shippingAddress:"1",billingName:"",billingAddress1:"",billingAddress2:"",billingAddress3:"",billingTown:"",billingPostcode:"",billingCountry:""}},{id:"confirmation",title:"Confirmation",component:"",completed:!1,active:!1,canVisit:!1,data:{}}]}},methods:{headerCircleBackground:function(t){return t.completed||t.active?"bg-yellow":t.canVisit?"bg-white":"bg-grey-off-dark"},completeSection:function(t){var e=this.sections.findIndex((function(e){return e.id===t.id}));this.sections[e].data=t.data,this.sections[e].completed=!0,this.sections[e].active=!1,this.sections[e].canVisit=!0,this.sections[e+1].active=!0,this.sections[e+1].canVisit=!0,"shipping-address"===this.sections[e].id&&!1===this.sections[2].completed&&(this.sections[2].data={provider:"",shippingAddress:"1",billingName:this.sections[0].data.name,billingAddress1:this.sections[1].data.address1,billingAddress2:this.sections[1].data.address2,billingAddress3:this.sections[1].data.address3,billingTown:this.sections[1].data.town,billingPostcode:this.sections[1].data.postcode,billingCountry:sessionStorage.getItem("checkout-country")}),sessionStorage.setItem("checkout-data",JSON.stringify(this.sections))},goBack:function(){var t=this.sections.findIndex((function(t){return!0===t.active}));0!==t&&(this.sections[t].active=!1,this.sections[t-1].active=!0)},switchSection:function(t){!0===t.canVisit&&(this.sections.find((function(t){return!0===t.active})).active=!1,this.sections.find((function(e){return e.id===t.id})).active=!0,this.googleEvent("event","checkout-progress",{event_label:t.title}))}},computed:{activeComponent:function(){return this.sections.find((function(t){return!0===t.active})).component},currentData:function(){return this.sections.find((function(t){return!0===t.active})).data}}};const S=(0,p.Z)(E,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-blue-gradient w-full rounded-lg p-2 shadow mx-auto max-w-11/12"},[a("div",{staticClass:"flex flex-col xs:flex-row xs:justify-between xs:pt-4 mb-4"},[t._l(t.sections,(function(e){return[a("div",{staticClass:"flex xs:flex-col xs:flex-1",class:e.canVisit?"cursor-pointer":"",on:{click:function(a){return t.switchSection(e)}}},[a("div",{staticClass:"px-4 relative xs:px-0"},[a("div",{staticClass:"w-5 h-5 rounded-full absolute text-white",class:t.headerCircleBackground(e),staticStyle:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),t._v(" "),a("div",{staticClass:"border-4 border-yellow h-full"})]),t._v(" "),a("div",{staticClass:"flex-1 py-3 xs:text-center",class:e.completed||e.active||e.canVisit?"font-semibold text-black":"text-grey"},[t._v("\n                    "+t._s(e.title)+"\n                ")])])]}))],2),t._v(" "),a("div",[a(t.activeComponent,{tag:"component",attrs:{"default-data":t.currentData,"country-id":t.countryId}})],1)])}),[],!1,null,null,null).exports;var P=a(2287),A=a(931);const q={mixins:[s.Z],components:{loader:P.Z,modal:A.Z,"form-input":r.Z},data:function(){return{discountCode:"",loading:!1}},mounted:function(){var t=this;this.googleEvent("event","checkout-progress",{event_category:"opened-discount-modal"}),this.$root.$on("code-change",(function(e){t.discountCode=e}))},methods:{validateCode:function(){var t=this;this.loading=!0,coeliac().request().post("/api/shop/basket/discount",{code:this.discountCode}).then((function(e){if(200===e.status)return t.googleEvent("event","checkout-progress",{event_category:"applied-discount",event_label:t.discountCode}),coeliac().success("Yay! We've validated your ".concat(e.data.name," discount code and added it to your order!")),void t.$root.$emit("basket-discount-code-validated");t.reportError()})).catch((function(){t.reportError()}))},reportError:function(){this.googleEvent("event","checkout-progress",{event_category:"invalid-discount",event_label:this.discountCode}),this.loading=!1,coeliac().error("Sorry, there was an error validating your discount code, please check your code and try again.")}}};const Z=(0,p.Z)(q,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("modal",{attrs:{"modal-classes":"w-3/4"}},[a("loader",{attrs:{show:t.loading}}),t._v(" "),a("div",{staticClass:"w-full flex flex-col"},[a("div",{staticClass:"mb-2"},[a("p",[t._v("\n                Lucky enough to have a discount code? Enter it below and we'll validate it and add it to your order!\n            ")])]),t._v(" "),a("div",{staticClass:"mb-2"},[a("form-input",{attrs:{name:"code",placeholder:"Enter your discount code...",value:t.discountCode,required:""}})],1),t._v(" "),a("div",{staticClass:"text-center"},[a("button",{staticClass:"w-full bg-yellow rounded-lg py-2 px-4 font-semibold",on:{click:function(e){return t.validateCode()}}},[t._v("\n                Validate Discount Code\n            ")])])])],1)}),[],!1,null,null,null).exports;const V={mixins:[i.Z],components:{"form-select":h.Z},props:{subtotal:{required:!0,type:Number},postage:{required:!0,type:Number},total:{required:!0,type:Number},country:{required:!0,type:Number},dispatch:{required:!0,type:String},discount:{required:!0,type:Object|Array}},data:function(){return{countries:[],selectedCountry:[]}},mounted:function(){var t=this;this.selectedCountry=this.country,this.getCountries(),sessionStorage.getItem("checkout-country")||sessionStorage.setItem("checkout-country","United Kingdom"),this.$root.$on("country-change",(function(e){e.toString()!==t.selectedCountry.toString()&&(t.selectedCountry=e,t.selectCountry(e),sessionStorage.setItem("checkout-country",t.countries.find((function(t){return e===t.value})).label))}))},methods:{getCountries:function(){var t=this;coeliac().request().get("/api/shop/countries").then((function(e){200===e.status&&t.$set(t,"countries",e.data)}))},selectCountry:function(t){var e=this;coeliac().request().post("/api/shop/countries",{country:t}).then((function(t){200!==t.status?coeliac().error("Sorry, there was an error selecting the country"):e.$root.$emit("basket-updated")})).catch((function(){coeliac().error("Sorry, there was an error selecting the country")}))}}};const L=(0,p.Z)(V,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-yellow rounded-lg p-2"},[a("table",{staticClass:"w-full text-lg"},[a("tr",[a("td",[t._v("Subtotal")]),t._v(" "),a("td",{staticClass:"text-right",domProps:{innerHTML:t._s(t.formatPrice(t.subtotal))}})]),t._v(" "),t.discount&&Object.keys(t.discount).length>0?a("tr",[a("td",[t._v("\n                "+t._s(t.discount.name)+"\n            ")]),t._v(" "),a("td",{staticClass:"text-right",domProps:{innerHTML:t._s("-"+t.formatPrice(t.discount.deduction))}})]):t._e(),t._v(" "),a("tr",[a("td",[t._v("\n                Postage to\n                "),a("form-select",{attrs:{required:"",name:"country",options:t.countries,value:t.country.toString(),padding:"p-1"}})],1),t._v(" "),a("td",{staticClass:"text-right",domProps:{innerHTML:t._s(t.formatPrice(t.postage))}})]),t._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[t._v("\n                Usually dispatched in "+t._s(t.dispatch)+" days\n            ")])]),t._v(" "),a("tr",{staticClass:"text-xl font-semibold"},[a("td",[t._v("Grand Total")]),t._v(" "),a("td",{staticClass:"text-right",domProps:{innerHTML:t._s(t.formatPrice(t.total))}})])])])}),[],!1,null,null,null).exports,T={mixins:[i.Z,o.Z],components:{"basket-checkout-wrapper":S,"basket-discount-modal":Z,"basket-page-totals":L,loader:P.Z},data:function(){return{loading:!0,showDiscountModal:!1,data:{items:[],subtotal:0,postage:0,country:1,delivery:"1 - 2",total:0}}},mounted:function(){var t=this;this.getData(),this.$root.$on("product-updated",(function(){t.getData()})),this.$root.$on("basket-updated",(function(){t.getData()})),this.$root.$on("modal-closed",(function(){document.querySelector("body").classList.remove("overflow-hidden"),t.showDiscountModal=!1})),this.$root.$on("basket-discount-code-validated",(function(){document.querySelector("body").classList.remove("overflow-hidden"),t.showDiscountModal=!1,t.getData()}))},methods:{getData:function(){var t=this;this.loading=!0,coeliac().request().get("/api/shop/basket/summary").then((function(e){200===e.status&&(t.data=e.data,t.loading=!1,0===t.data.items.length&&sessionStorage.removeItem("checkout-data"),t.loadLazyImages())}))}}};const N=(0,p.Z)(T,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"relative w-full min-h-map"},[a("loader",{attrs:{show:t.loading}}),t._v(" "),t.loading||0!==t.data.items.length?t._e():a("div",[a("p",[t._v("Sorry, you've got no items in your basket, why not take a look at some of these products instead?")])]),t._v(" "),!t.loading&&t.data.items.length>0?a("div",{staticClass:"flex flex-col"},[a("div",{staticClass:"bg-blue-gradient shadow rounded-lg p-2 mx-auto max-w-11/12"},[a("p",{staticClass:"mb-4"},[t._v("Below are the items in your shopping basket, you can alter quantities and delete items\n                if needed.")]),t._v(" "),a("div",{staticClass:"flex flex-col mb-4"},t._l(t.data.items,(function(e){return a("div",{staticClass:"flex py-2 leading-tight"},[a("div",{staticClass:"w-1/4 pr-2 sm:w-1/5"},[a("img",{staticClass:"lazy",attrs:{"data-src":e.product.first_image,src:t.lazyLoadSrc,loading:"lazy",alt:""}})]),t._v(" "),a("div",{staticClass:"w-3/4 flex flex-col sm:flex-row sm:w-4/5 sm:justify-between"},[a("div",{staticClass:"sm:mr-2"},[a("h3",{staticClass:"text-lg font-semibold mb-1"},[t._v("\n                                "+t._s(e.product.title)+"\n                                "),""!==e.variant.title?a("span",[t._v("("+t._s(e.variant.title)+")")]):t._e()])]),t._v(" "),a("div",{staticClass:"flex mb-1 sm:flex-col sm:mr-2"},[a("div",{staticClass:"font-semibold mr-1 sm:mr-0 sm:mb-2"},[t._v("Price")]),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.formatPrice(e.product_price))}})]),t._v(" "),a("div",{staticClass:"flex mb-1 sm:flex-col sm:mr-2"},[a("div",{staticClass:"font-semibold mr-1 sm:mr-0 sm:mb-2"},[t._v("Quantity")]),t._v(" "),a("div",[a("basket-quantity-swticher",{attrs:{quantity:e.quantity,"product-id":e.product.id,"variant-id":e.variant.id}})],1)]),t._v(" "),a("div",{staticClass:"flex mb-1 sm:flex-col sm:mr-2"},[a("div",{staticClass:"font-semibold mr-1 sm:mr-0 sm:mb-2"},[t._v("Subtotal")]),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.formatPrice(e.subtotal))}})])])])})),0),t._v(" "),t.data.discount!==[]?a("button",{staticClass:"mb-4 -mt-2 py-2 px-4 bg-yellow rounded-lg text-lg text-semibold w-full",on:{click:function(e){t.showDiscountModal=!0}}},[t._v("\n                Got a discount code?\n            ")]):t._e(),t._v(" "),a("basket-page-totals",{attrs:{country:t.data.country,postage:t.data.postage,subtotal:t.data.subtotal,total:t.data.total,dispatch:t.data.delivery,discount:t.data.discount}})],1)]):t._e(),t._v(" "),!t.loading&&t.data.items.length>0?a("div",{staticClass:"flex justify-center mt-4"},[a("basket-checkout-wrapper",{attrs:{"country-id":t.data.country}})],1):t._e(),t._v(" "),t.showDiscountModal?a("portal",{attrs:{to:"modal"}},[a("basket-discount-modal")],1):t._e()],1)}),[],!1,null,null,null).exports},511:(t,e,a)=>{"use strict";a.d(e,{Z:()=>l});const i={mixins:[a(2102).Z]};var o=a(3379),s=a.n(o),r=a(7289),n={insert:"head",singleton:!1};s()(r.Z,n);r.Z.locals;const l=(0,a(1900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex overflow-hidden border border-blue rounded"},[a("div",{staticClass:"bg-grey-lightest p-0 flex-1"},["checkbox"===t.type?a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"w-full bg-transparent border-0 p-3 m-0 text-grey-darkest",class:t.disabled?"text-grey-light cursor:not-allowed":"",attrs:{name:t.name,placeholder:t.placeholder,min:t.min,max:t.max,disabled:t.disabled,type:"checkbox"},domProps:{checked:Array.isArray(t.currentValue)?t._i(t.currentValue,null)>-1:t.currentValue},on:{blur:function(e){return t.validate()},change:function(e){var a=t.currentValue,i=e.target,o=!!i.checked;if(Array.isArray(a)){var s=t._i(a,null);i.checked?s<0&&(t.currentValue=a.concat([null])):s>-1&&(t.currentValue=a.slice(0,s).concat(a.slice(s+1)))}else t.currentValue=o}}}):"radio"===t.type?a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"w-full bg-transparent border-0 p-3 m-0 text-grey-darkest",class:t.disabled?"text-grey-light cursor:not-allowed":"",attrs:{name:t.name,placeholder:t.placeholder,min:t.min,max:t.max,disabled:t.disabled,type:"radio"},domProps:{checked:t._q(t.currentValue,null)},on:{blur:function(e){return t.validate()},change:function(e){t.currentValue=null}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"w-full bg-transparent border-0 p-3 m-0 text-grey-darkest",class:t.disabled?"text-grey-light cursor:not-allowed":"",attrs:{name:t.name,placeholder:t.placeholder,min:t.min,max:t.max,disabled:t.disabled,type:t.type},domProps:{value:t.currentValue},on:{blur:function(e){return t.validate()},input:function(e){e.target.composing||(t.currentValue=e.target.value)}}})]),t._v(" "),t.hasError&&t.showError?a("div",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:{content:t.errorText,classes:["bg-red","border-red","text-white"],boundariesElement:"body"},expression:"{content: errorText, classes: ['bg-red', 'border-red', 'text-white'], boundariesElement: 'body'}",modifiers:{left:!0}}],staticClass:"bg-red flex justify-center items-center p-2 text-white"},[a("font-awesome-icon",{attrs:{icon:["fas","exclamation-circle"]}})],1):t._e()])}),[],!1,null,null,null).exports},2460:(t,e,a)=>{"use strict";a.d(e,{Z:()=>l});const i={mixins:[a(2102).Z],props:{options:{required:!0,type:Array},padding:{default:"p-3"},label:{type:String,default:null}}};var o=a(3379),s=a.n(o),r=a(5117),n={insert:"head",singleton:!1};s()(r.Z,n);r.Z.locals;const l=(0,a(1900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.label?a("span",{staticClass:"block font-semibold text-lg mb-2"},[t._v(t._s(t.label))]):t._e(),t._v(" "),a("div",{staticClass:"flex overflow-hidden border border-blue rounded"},[a("div",{staticClass:"bg-grey-lightest p-0 flex-1"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"w-full bg-transparent border-0 m-0 text-grey-darkest",class:t.padding,attrs:{name:t.name},on:{blur:function(e){return t.validate()},change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.currentValue=e.target.multiple?a:a[0]}}},t._l(t.options,(function(e){return a("option",{domProps:{value:e.value,textContent:t._s(e.label)}})})),0)]),t._v(" "),t.hasError&&t.showError?a("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:{content:t.errorText,classes:["bg-red","border-red","text-white"]},expression:"{content: errorText, classes: ['bg-red', 'border-red', 'text-white']}",modifiers:{bottom:!0}}],staticClass:"bg-red flex justify-center items-center p-2 text-white"},[a("font-awesome-icon",{attrs:{icon:["fas","exclamation-circle"]}})],1):t._e()])])}),[],!1,null,null,null).exports},2287:(t,e,a)=>{"use strict";a.d(e,{Z:()=>o});const i={props:{show:{type:Boolean,default:!1},width:{type:String,default:"50%"},height:{type:String,default:"50%"},maxWidth:{type:String,default:"50px"},maxHeight:{type:String,default:"50px"},background:{type:String,default:"bg-transparent"},fadedBorderColor:{type:String,default:"border-blue-20"},primaryBorderColor:{type:String,default:"#80CCFC"},backgroundPosition:{type:String,default:"absolute"},borderWidth:{type:String,default:"5px"}},computed:{loaderStyles:function(){return{borderTopColor:this.primaryBorderColor,borderWidth:this.borderWidth,width:this.width,height:this.height,maxWidth:this.maxWidth,maxHeight:this.maxHeight}}}};const o=(0,a(1900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"top-0 left-0 flex justify-center items-center w-full h-full z-max",class:[t.background,t.backgroundPosition]},[a("div",{staticClass:"rounded-full spin",class:t.fadedBorderColor,style:t.loaderStyles})])}),[],!1,null,null,null).exports},931:(t,e,a)=>{"use strict";a.d(e,{Z:()=>o});const i={props:{name:{type:String,default:""},modalClasses:{type:Array|String,default:function(){return[]}},small:{type:Boolean,default:!1}},mounted:function(){var t=this;document.querySelector("body").classList.add("overflow-hidden"),this.$root.$on("close-modal",(function(e){e&&e!==t.name||t.close()}))},methods:{close:function(){document.querySelector("body").classList.remove("overflow-hidden"),this.$root.$emit("modal-closed",this.name)}},computed:{computedClasses:function(){var t=this.modalClasses;Array.isArray(t)||(t=t.split(" "));var e="max-w-modal";return this.small&&(e="max-w-modal-small"),t.push(e),t}}};const o=(0,a(1900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-max fixed inset-0 w-full h-full bg-black-80 flex justify-center items-center",on:{click:function(e){return e.target!==e.currentTarget?null:t.close()}}},[a("div",{staticClass:"h-auto max-h-3/4 shadow p-2 border-2 border-blue-light w-auto rounded-lg bg-blue-light overflow-y-scroll",class:t.computedClasses},[a("div",{staticClass:"h-full relative"},[a("div",{staticClass:"absolute top-0 right-0 bg-white p-1 -mt-1 -mr-1 leading-none z-50 rounded border border-black cursor-pointer transition-bg",on:{click:function(e){return t.close()}}},[a("font-awesome-icon",{attrs:{icon:["fas","times"]}})],1),t._v(" "),a("div",{staticClass:"h-full w-full bg-white-80 p-2 rounded"},[t._t("default")],2)])])])}),[],!1,null,null,null).exports}}]);